<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand">Admin Profile</a>
    <a href="/admin/dashboard" class="btn btn-outline-light me-2">‚¨Ö Back</a>
    <form th:action="@{/logout}" method="post" class="d-inline">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      <button class="btn btn-danger">Logout</button>
    </form>
  </div>
</nav>

<div class="container mt-5">
  <div class="card shadow border-0 rounded-4 p-4 mx-auto" style="max-width: 600px;">
    <h3 class="text-center mb-4 fw-bold">üë§ My profile</h3>

    <form id="adminEditForm">
      <input type="hidden" id="adminId" th:value="${admin.id}">

      <div class="row mb-3">
        <div class="col">
          <label class="form-label">First Name</label>
          <input type="text" id="firstName" th:value="${admin.firstName}" class="form-control" required>
        </div>
        <div class="col">
          <label class="form-label">Last Name</label>
          <input type="text" id="lastName" th:value="${admin.lastName}" class="form-control" required>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Age</label>
        <input type="number" id="age" th:value="${admin.age}" class="form-control" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Email</label>
        <input type="email" id="email" th:value="${admin.email}" class="form-control" required>
      </div>

      <div class="mb-3">
        <label class="form-label">New Password (optional)</label>
        <input type="password" id="password" class="form-control" placeholder="Leave blank to keep current">
      </div>

      <button type="button" class="btn btn-success w-100" onclick="saveAdmin()">Save Changes</button>
    </form>

    <div id="message" class="mt-3 text-center fw-semibold"></div>
  </div>
</div>

<script>
  async function saveAdmin() {
    const id = document.getElementById("adminId").value;
    const body = {
      firstName: document.getElementById("firstName").value.trim(),
      lastName: document.getElementById("lastName").value.trim(),
      age: parseInt(document.getElementById("age").value),
      email: document.getElementById("email").value.trim(),
      password: document.getElementById("password").value.trim()
    };

    const res = await fetch(`/api/users/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });

    const msg = document.getElementById("message");
    if (res.ok) {
      msg.textContent = "‚úÖ Profile updated successfully!";
      msg.classList.add("text-success");
      document.getElementById("password").value = "";
    } else {
      msg.textContent = "‚ùå Failed to update profile.";
      msg.classList.add("text-danger");
    }
  }
</script>

</body>
</html>